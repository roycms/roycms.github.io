{"title":"hexo image 用阿里云存储","slug":"hexo-image-用阿里云存储","date":"2017-03-26T11:43:00.000Z","updated":"2017-03-27T09:20:31.000Z","comments":true,"path":"api/articles/hexo-image-用阿里云存储.json","excerpt":"","content":"<h4 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h4><p>安装 hexo-admin,co,ali-oss<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">cd 项目目录</div><div class=\"line\">npm install hexo-admin </div><div class=\"line\">npm install co</div><div class=\"line\">npm install ali-oss</div></pre></td></tr></table></figure></p>\n<h4 id=\"第二步\"><a href=\"#第二步\" class=\"headerlink\" title=\"第二步\"></a>第二步</h4><p>open /node_modules/hexo-admin/api.js 在头部加入代码<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">var co = require(&apos;co&apos;)</div><div class=\"line\">var oss = require(&apos;ali-oss&apos;)</div></pre></td></tr></table></figure></p>\n<p>在 module.exports 内初始化阿里云<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">module.exports = function (app, hexo) &#123;</div><div class=\"line\"></div><div class=\"line\">  //初始化阿里云</div><div class=\"line\">  var client = new oss(&#123;</div><div class=\"line\">    region: &apos;你的region&apos;,</div><div class=\"line\">    accessKeyId: &apos;你的accessKeyId&apos;,</div><div class=\"line\">    accessKeySecret: &apos;你的accessKeySecret&apos;</div><div class=\"line\">  &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>在 400 行代码处找到如下代码 注释掉或者删除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">hexo.log.d(`saving image to $&#123;outpath&#125;`)</div><div class=\"line\">fs.writeFile(outpath, buf, function (err) &#123;</div><div class=\"line\">  if (err) &#123;</div><div class=\"line\">    console.log(err)</div><div class=\"line\">  &#125;</div><div class=\"line\">  hexo.source.process().then(function () &#123;</div><div class=\"line\">    res.done(&#123;</div><div class=\"line\">      src: path.join(hexo.config.root + filename),</div><div class=\"line\">      msg: msg</div><div class=\"line\">    &#125;)</div><div class=\"line\">  &#125;);</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure></p>\n<p>在400行处添加代码<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">var objectKey = &quot;hexoResource/&quot; + Date.now() + filename</div><div class=\"line\"></div><div class=\"line\">  co(function* () &#123;</div><div class=\"line\">    client.useBucket(&apos;server-19860911&apos;);</div><div class=\"line\">    var result = yield client.put(objectKey, buf);</div><div class=\"line\">    // console.log(&quot;|||||||||||||=======&quot;+result);</div><div class=\"line\">    var returnFileName = &quot;https://server-19860911.oss-cn-beijing.aliyuncs.com/&quot; + objectKey</div><div class=\"line\">    hexo.source.process().then(function () &#123;</div><div class=\"line\">      res.done(&#123;</div><div class=\"line\">        src: returnFileName,</div><div class=\"line\">        msg: msg</div><div class=\"line\">      &#125;)</div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">  &#125;).catch(function (err) &#123;</div><div class=\"line\">    console.log(&quot;|||||||||||||&quot;+err);</div><div class=\"line\">  &#125;);</div></pre></td></tr></table></figure></p>\n","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"技术","path":"api/tags/技术.json"},{"name":"阿里云","path":"api/tags/阿里云.json"},{"name":"hexo","path":"api/tags/hexo.json"}]}